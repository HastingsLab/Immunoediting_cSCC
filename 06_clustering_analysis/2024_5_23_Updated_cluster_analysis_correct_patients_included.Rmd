---
title: "2024_5_1_Upddated_clustering_anlaysis_fix_patients_included"
output: html_document
date: "2024-05-1"
---

**Purpose:**

* Updating cluster analysis

**Methods:**

* Read in the data for each patient

* Leave out patient treated with dupilimumab

* Combine into a master spreadsheet

* Scale all values

* Perform unsupervised hierarchical clustering across all characteristics and neoantigens

* Annotate unique groups of neoantigens

* Assess the relative frequency of these neoantigens in clonal and subclonal neoantigens for immunogenic and non-immunogenic neoantigens in immunosuppressed and immunocompetent patients

**Results:**

```{r, warning=FALSE, message=FALSE}
library(pheatmap)
library(ggbiplot)
library(ggplot2)
library(Seurat)
library(viridis)
library(Rtsne)
library(dplyr)
library(GO.db)
library(org.Hs.eg.db)
library(plyr)
```


## Read in data
```{r}
clinical_data <- as.data.frame(read.csv("~/3.0 Hasting Research/Immunoediting_human_work/Simple_metadata_immune_annotations.csv"))
clinical_data <- clinical_data[-which(is.na(clinical_data$Tumor_Sample_Barcode)),]
clinical_data <- clinical_data[-which(clinical_data$Tumor_Sample_Barcode=="s_CSCC-302_-_T2a_B4_DNA"),]

#clinical_data <- clinical_data[1:2,]

data <- matrix(NA, nrow=1, ncol=13)
colnames(data) <- c("Peptide", "ID", "gene_id", "expression", "TAP", "Cle",
                    "min_kd", "min_stab", "CCF", "EC", "DAI", "Patient", "Immunosuppression")



for (i in 1:length(clinical_data$Tumor_Sample_Barcode)){
  tumor_id <- clinical_data$Tumor_Sample_Barcode[i]
  patient_id <- clinical_data$ID[i]
  if (!file.exists(paste("~/3.0 Hasting Research/Immunoediting_human_work/Characteristic_tables/", patient_id, "_all_characteristics.csv", sep=""))){
    cat("File not ready yet! \n")
  } else {
    data_temp <- as.data.frame(read.csv(paste("~/3.0 Hasting Research/Immunoediting_human_work/Characteristic_tables/", patient_id, "_all_characteristics_add_EC.csv", sep=""), row.names=1))
  
    data_temp <- data_temp[, which(colnames(data_temp) %in% c("Peptide", "ID", "gene_id", "expression", "TAP", "Cle",
                    "min_kd", "min_stab", "min_WT_kd", "CCF", "EC"))]
    
    test <- data_temp[which(is.na(data_temp$TAP)),]
    print(length(test$Peptide))
    if (length(test$Peptide)>0){
      data_temp <- data_temp[-which(is.na(data_temp$TAP)),]
    }
    
    data_temp$DAI <- data_temp$min_WT_kd/data_temp$min_kd
    
    data_temp <- data_temp[, which(colnames(data_temp) %in% c("Peptide", "ID", "gene_id", "expression", "TAP", "Cle",
                    "min_kd", "min_stab", "DAI", "CCF","EC", "DAI"))]
    data_temp$Patient <- patient_id
    data_temp$Immunosuppression <- clinical_data$Immunosuppression[i]
    data <- rbind(data, data_temp)
  
  }
}
#data <- data[-which(is.na(data$CCF)),]

data <- data[-1,]
```

## Normalize data
```{r}
data$expression <- scale(log(data$expression+0.01,10), center = TRUE)
data$TAP <- scale(data$TAP, center=TRUE)
data$Cle <- scale(data$Cle, center=TRUE)
data$min_kd <- scale(log(data$min_kd+0.01,10), center=TRUE)
data$min_stab <- scale(log(data$min_stab+0.01,10), center=TRUE)
data$DAI <- scale(log(data$DAI+0.01,10), center=TRUE)
data$EC <- scale(data$EC, center=TRUE)
```

## Visualize heatmap

```{r}
data_plot <- t(data[,c(4:8,10:11)])

## Elbow plot
data_kmeans <- t(data_plot)
wcss <- matrix(NA, nrow=10, ncol=1)
for (i in 1:10){
  print(i)
  kmeans_result <- kmeans(data_kmeans, centers=i, nstart=10)
  wcss[i] <- sum(kmeans_result$tot.withinss)
}
elbow_data <- data.frame(Clusters=1:10, WCSS=wcss)

ggplot(elbow_data, aes(x = Clusters, y = WCSS)) +
  geom_line() +
  geom_point() +
  ggtitle("Elbow Method") +
  xlab("Number of Clusters") +
  ylab("WCSS")

## Gap statistic
library(cluster)
library(factoextra)
set.seed(123)
gap_stat <- clusGap(data_kmeans, FUN = hcut, K.max = 10, B = 1)

#colors <- colorRampPalette(c("black", "darkmagenta", "yellow"))(100)
colors <- colorRampPalette(RColorBrewer::brewer.pal(11,"BrBG"))(256)

groups <- pheatmap(data_plot, cluster_rows=FALSE, labels_col=NULL, cutree_cols = 8, color = colors)

data$clusters <- cutree(groups$tree_col, k=8)

col_cluster_annotations <- data$clusters
col_cluster_annotations <- as.data.frame(col_cluster_annotations)
row.names(col_cluster_annotations) <- colnames(data_plot)
col_cluster_annotations$col_cluster_annotations <- as.factor(col_cluster_annotations$col_cluster_annotations)

pheatmap(data_plot, cluster_rows=FALSE, show_colnames=FALSE, cutree_cols = 8, color = colors, annotation_col = col_cluster_annotations)

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Heatmap_v4.pdf", width=20, height=10)
pheatmap(data_plot, cluster_rows=FALSE, show_colnames=FALSE, cutree_cols = 8, color = colors, annotation_col = col_cluster_annotations)
dev.off()
```

## Plot characteristic boxplots between the clusters
```{r}
ggplot(data, aes(x=reorder(as.factor(clusters), -expression), y=expression)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Expression_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -expression), y=expression)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), -TAP), y=TAP)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Tap_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -TAP), y=TAP)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), -Cle), y=Cle)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Cle_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -Cle), y=Cle)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), min_kd), y=min_kd)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Kd_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), min_kd), y=min_kd)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), -min_stab), y=min_stab)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/Stab_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -min_stab), y=min_stab)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), -DAI), y=DAI)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/DAI_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -DAI), y=DAI)) + 
  geom_violin() + theme_minimal()
dev.off()

ggplot(data, aes(x=reorder(as.factor(clusters), -EC), y=EC)) + 
  geom_violin() + theme_minimal()

pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/EC_v_clusters_v4.pdf")
ggplot(data, aes(x=reorder(as.factor(clusters), -EC), y=EC)) + 
  geom_violin() + theme_minimal()
dev.off()
```

## Compare frequency different clusters immunocompetent, immunosuppressed, clonal, subclonal
```{r}
patients <- unique(data$Patient)
summary <- matrix(NA, nrow=length(unique(data$Patient)), ncol=21)

for (i in 1:length(patients)){
  patient = patients[i]
  summary[i,2] <- length(data[which(data$Patient==patient & data$clusters==1 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,3] <- length(data[which(data$Patient==patient & data$clusters==2 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,4] <- length(data[which(data$Patient==patient & data$clusters==3 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,5] <- length(data[which(data$Patient==patient & data$clusters==4 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,6] <- length(data[which(data$Patient==patient & data$clusters==5 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,7] <- length(data[which(data$Patient==patient & data$clusters==6 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,8] <- length(data[which(data$Patient==patient & data$clusters==7 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,9] <- length(data[which(data$Patient==patient & data$clusters==8 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,10] <- length(data[which(data$Patient==patient & data$clusters==9 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,11] <- length(data[which(data$Patient==patient & data$clusters==10 & data$CCF > 0.75),1])/length(data[which(data$Patient==patient & data$CCF > 0.75),1])
  summary[i,12] <- length(data[which(data$Patient==patient & data$clusters==1 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,13] <- length(data[which(data$Patient==patient & data$clusters==2 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,14] <- length(data[which(data$Patient==patient & data$clusters==3 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,15] <- length(data[which(data$Patient==patient & data$clusters==4 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,16] <- length(data[which(data$Patient==patient & data$clusters==5 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,17] <- length(data[which(data$Patient==patient & data$clusters==6 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,18] <- length(data[which(data$Patient==patient & data$clusters==7 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,19] <- length(data[which(data$Patient==patient & data$clusters==8 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,20] <- length(data[which(data$Patient==patient & data$clusters==9 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
  summary[i,21] <- length(data[which(data$Patient==patient & data$clusters==10 & data$CCF < 0.75),1])/length(data[which(data$Patient==patient & data$CCF < 0.75),1])
}

summary[,1] <- patients
summary <- as.data.frame(summary)
summary[(summary=="NaN")] <- 0
colnames(summary) <- c("Patient", "C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C1.1", "C2.1", "C3.1", "C4.1", "C5.1", "C6.1", "C7.1", "C8.1", "C9.1", "C10.1")
summary_plot <- reshape::melt(summary, id.vars=c("Patient"))
summary_plot$Clonal <- NA
summary_plot[1:420,4] <- "Clonal"
summary_plot[421:840,4] <- "Sub-clonal"
summary_plot$variable <- gsub("\\..*", "", summary_plot$variable)
clinical_data_temp <- clinical_data[match(summary_plot$Patient, clinical_data$ID),]
summary_plot$Immunosuppression <- clinical_data_temp$Immunosuppression
summary_plot$immune_clonal <- paste(summary_plot$Immunosuppression, summary_plot$Clonal, sep="_")
```


### Boxplots of different clusters
```{r}
C <- summary_plot[which(summary_plot$variable=="C1"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)

#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C1_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C2"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
t.test(as.numeric(C_ic_c$value), as.numeric(C_is_c$value), paired=TRUE)
t.test(as.numeric(C_ic_sc$value), as.numeric(C_is_sc$value), paired=TRUE)
pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C2_v4_boxplot.pdf")
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C3"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#t.test(as.numeric(C_is_c$value), as.numeric(C_ic_c$value))
#t.test(as.numeric(C_is_sc$value), as.numeric(C_ic_sc$value))
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C3_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C4"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C4_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C5"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C5_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C6"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C6_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C7"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C7_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C8"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C8_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C9"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C9_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

```{r}
C <- summary_plot[which(summary_plot$variable=="C10"),]
ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
C_ic_c <- C[which(C$immune_clonal=="No_Clonal"),]
C_ic_sc <- C[which(C$immune_clonal=="No_Sub-clonal"),]
C_is_c <- C[which(C$immune_clonal=="Yes_Clonal"),]
C_is_sc <- C[which(C$immune_clonal=="Yes_Sub-clonal"),]
t.test(as.numeric(C_ic_c$value), as.numeric(C_ic_sc$value), paired=TRUE)
t.test(as.numeric(C_is_c$value), as.numeric(C_is_sc$value), paired=TRUE)
#pdf("~/3.0 Hasting Research/Immunoediting_human_work/Characteristics clonal subclonal neoags/Neoantigen Clustering Approach/Figures/C10_v3_boxplot.pdf")
#ggplot(C, aes(x=immune_clonal, y=as.numeric(value))) + geom_boxplot(outlier.shape = NA) + geom_jitter(width=0.05) + theme_minimal()
#dev.off()
```

**Interpretation:**

* Preliminary evidence of at least one lost set of neoantigens, selectively in immunocompetent patients

**Futures steps:**

1) Validate input spreadsheets for accuracy - at least one per patient

2) Consider the best scaling approaches - maybe meet with Bonnie

3) Consider changing the number of groups that the heatmap splits into - experiment with increased numbers and decreased numebrs

4) Combile into powerpoint for lab meeting